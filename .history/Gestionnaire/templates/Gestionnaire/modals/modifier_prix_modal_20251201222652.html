<!-- Modal pour modifier le prix -->
<div class="modal fade" id="modifierPrixModal" tabindex="-1" aria-labelledby="modifierPrixModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modifierPrixModalLabel">
                    <i class="bi bi-currency-exchange me-2"></i>
                    Définir le prix de la livraison
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
            </div>
            <form method="post" action="{% url 'Gestionnaire:modifier_prix' demande.id %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="prix" class="form-label fw-bold">Prix de la livraison (FCFA)</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-cash-coin"></i></span>
                            <input type="number" 
                                   class="form-control" 
                                   id="prix" 
                                   name="prix" 
                                   value="{{ demande.cout_livraison|default:'' }}" 
                                   min="0" 
                                   step="0.01" 
                                   required
                                   placeholder="Entrez le montant en FCFA">
                        </div>
                        <div class="form-text">
                            Le statut passera à "Validation client" après enregistrement.
                        </div>
                        <input type="hidden" name="nouveau_statut" value="VALIDATION_CLIENT">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-1"></i> Annuler
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-circle me-1"></i> Enregistrer
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
// Script pour gérer le modal de modification de prix
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('modifierPrixModal');
    
    if (modal) {
        // Réinitialiser le formulaire quand le modal est fermé
        modal.addEventListener('hidden.bs.modal', function () {
            this.querySelector('form').reset();
        });
        
        // Validation du formulaire avant soumission
        const form = modal.querySelector('form');
        form.addEventListener('submit', function(e) {
            const prixInput = document.getElementById('prix');
            if (parseFloat(prixInput.value) <= 0) {
                e.preventDefault();
                alert('Veuillez saisir un montant valide supérieur à 0');
                prixInput.focus();
            }
        });
    }
});
</script>
{% endblock %}

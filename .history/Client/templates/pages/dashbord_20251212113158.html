{% extends 'base.html' %}
{% load static %}

{% block page_name %}Tableau de bord{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.css">
<style>
    .stat-card {
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
    }
    .stat-card:hover {
        transform: translateY(-5px);
    }
    .stat-icon {
        font-size: 2.5rem;
        opacity: 0.8;
    }
    .chart-container {
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <h1 class="mb-4">Tableau de bord</h1>
    
    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-3 mb-4">
            <div class="card stat-card bg-primary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-uppercase">Commandes totales</h6>
                            <h2 class="mb-0">{{ total_orders }}</h2>
                        </div>
                        <i class="fas fa-shopping-cart stat-icon"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-4">
            <div class="card stat-card bg-success text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-uppercase">Terminées</h6>
                            <h2 class="mb-0">{{ completed_orders }}</h2>
                        </div>
                        <i class="fas fa-check-circle stat-icon"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-4">
            <div class="card stat-card bg-warning text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-uppercase">En cours</h6>
                            <h2 class="mb-0">{{ in_progress_orders }}</h2>
                        </div>
                        <i class="fas fa-truck-loading stat-icon"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-4">
            <div class="card stat-card bg-danger text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-uppercase">Annulées</h6>
                            <h2 class="mb-0">{{ cancelled_orders }}</h2>
                        </div>
                        <i class="fas fa-times-circle stat-icon"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Charts Row -->
    <div class="row">
        <!-- Monthly Orders Chart -->
        <div class="col-lg-8 mb-4">
            <div class="chart-container">
                <h5 class="mb-4">Activité des commandes (6 derniers mois)</h5>
                <canvas id="monthlyOrdersChart"></canvas>
            </div>
        </div>
        
        <!-- Status Distribution Chart -->
        <div class="col-lg-4 mb-4">
            <div class="chart-container">
                <h5 class="mb-4">Répartition des statuts</h5>
                <canvas id="statusDistributionChart"></canvas>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
<script>
    // Monthly Orders Line Chart
    const monthlyCtx = document.getElementById('monthlyOrdersChart').getContext('2d');
    new Chart(monthlyCtx, {
        type: 'line',
        data: {
            labels: JSON.parse('{{ months|safe }}'),
            datasets: [{
                label: 'Commandes par mois',
                data: JSON.parse('{{ order_counts|safe }}'),
                borderColor: 'rgba(75, 192, 192, 1)',
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                tension: 0.3,
                fill: true
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    }
                }
            }
        }
    });
    
    // Status Distribution Doughnut Chart
    const statusCtx = document.getElementById('statusDistributionChart').getContext('2d');
    new Chart(statusCtx, {
        type: 'doughnut',
        data: {
            labels: JSON.parse('{{ status_labels|safe }}'),
            datasets: [{
                data: JSON.parse('{{ status_data|safe }}'),
                backgroundColor: [
                    '#4e73df',
                    '#1cc88a',
                    '#f6c23e',
                    '#e74a3b',
                    '#36b9cc',
                    '#5a5c69',
                    '#858796'
                ],
                hoverBackgroundColor: [
                    '#2e59d9',
                    '#17a673',
                    '#dda20a',
                    '#be2617',
                    '#2c9faf',
                    '#4e4e5c',
                    '#6c757d'
                ]
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'right',
                }
            }
        }
    });
</script>
{% endblock %}

{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>{{ page_title }}</h2>
        <a href="{% url 'Client:commande_history' %}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-1"></i> Retour à l'historique
        </a>
    </div>
    
    <div class="card mb-4">
        <div class="card-header bg-light">
            <h5 class="mb-0">Informations de la commande</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Référence :</strong> {{ commande.ref }}</p>
                    <p><strong>Date de la commande :</strong> {{ commande.date_demande|date:"d/m/Y H:i" }}</p>
                    <p><strong>Statut :</strong> 
                        <span class="badge {% if commande.statut == 'TERMINEE' %}bg-success{% else %}bg-danger{% endif %}">
                            {{ commande.get_statut_display }}
                        </span>
                    </p>
                    <p><strong>Type de course :</strong> {{ commande.get_type_course_display }}</p>
                    {% if commande.cout_livraison %}
                        <p><strong>Coût de livraison :</strong> {{ commande.cout_livraison }} FCFA</p>
                    {% endif %}
                </div>
                <div class="col-md-6">
                    {% if commande.coursier %}
                        <p><strong>Livreur :</strong> {{ commande.coursier.get_full_name|default:commande.coursier.username }}</p>
                    {% endif %}
                    {% if commande.distance %}
                        <p><strong>Distance :</strong> {{ commande.distance|floatformat:2 }} km</p>
                    {% endif %}
                    {% if commande.date_recuperation %}
                        <p><strong>Date de récupération :</strong> {{ commande.date_recuperation|date:"d/m/Y H:i" }}</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Adresses</h5>
                </div>
                <div class="card-body">
                    <h6>Point de départ</h6>
                    <p class="mb-3">{{ commande.adresse_depart }}</p>
                    
                    <h6>Destination</h6>
                    <p class="mb-0">{{ commande.adresse_destination }}</p>
                    {% if commande.Contact_destinateur %}
                        <p class="mt-2 mb-0"><strong>Contact :</strong> {{ commande.Contact_destinateur }}</p>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Détails du colis</h5>
                </div>
                <div class="card-body">
                    <p><strong>Description :</strong></p>
                    <p class="mb-3">{{ commande.description_colis }}</p>
                    
                    <div class="row">
                        <div class="col-6">
                            <p><strong>Poids :</strong> {{ commande.poids_colis }} kg</p>
                        </div>
                        <div class="col-6">
                            <p><strong>Valeur :</strong> {{ commande.valeur_colis }} FCFA</p>
                        </div>
                    </div>
                    
                    {% if commande.instructions %}
                        <p class="mt-3 mb-0"><strong>Instructions spéciales :</strong></p>
                        <p class="mb-0">{{ commande.instructions }}</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    {% if commande.photo_colis1 or commande.photo_colis2 %}
    <div class="card mb-4">
        <div class="card-header bg-light">
            <h5 class="mb-0">Photos du colis</h5>
        </div>
        <div class="card-body">
            <div class="row">
                {% if commande.photo_colis1 %}
                <div class="col-md-6 mb-3">
                    <img src="{{ commande.photo_colis1.url }}" alt="Photo du colis 1" class="img-fluid rounded">
                </div>
                {% endif %}
                {% if commande.photo_colis2 %}
                <div class="col-md-6 mb-3">
                    <img src="{{ commande.photo_colis2.url }}" alt="Photo du colis 2" class="img-fluid rounded">
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
    
    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
        <a href="{% url 'commande_history' %}" class="btn btn-outline-secondary me-md-2">
            <i class="fas fa-arrow-left me-1"></i> Retour à l'historique
        </a>
        {% if commande.statut == 'TERMINEE' %}
            <button type="button" class="btn btn-primary">
                <i class="fas fa-redo-alt me-1"></i> Commander à nouveau
            </button>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .card {
        border: 1px solid rgba(0,0,0,.125);
        border-radius: 0.5rem;
        box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075);
    }
    .card-header {
        border-bottom: 1px solid rgba(0,0,0,.125);
    }
    .img-fluid {
        max-height: 300px;
        object-fit: contain;
    }
</style>
{% endblock %}
